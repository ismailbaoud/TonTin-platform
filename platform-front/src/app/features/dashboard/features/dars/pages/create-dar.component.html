<!-- Main Content -->
<main class="flex-grow flex flex-col items-center py-8 px-4 sm:px-6 lg:px-8">
  <div class="w-full max-w-3xl flex flex-col gap-8">
    <!-- Breadcrumbs -->
    <div class="flex flex-wrap gap-2 items-center text-sm">
      <a
        class="text-primary hover:text-primary/80 font-medium"
        [routerLink]="['/dashboard/client']"
        >Home</a
      >
      <span class="text-gray-400 font-medium">/</span>
      <a
        class="text-primary hover:text-primary/80 font-medium"
        [routerLink]="['/dashboard/client/my-dars']"
        >Dârs</a
      >
      <span class="text-gray-400 font-medium">/</span>
      <span class="text-text-light dark:text-text-dark font-medium"
        >Create</span
      >
    </div>

    <!-- Page Heading -->
    <div class="flex flex-col gap-2">
      <h1
        class="text-4xl font-black tracking-tight text-text-light dark:text-white"
      >
        Create New Dâr
      </h1>
      <p class="text-lg text-gray-500 dark:text-gray-400">
        Set up the details for your rotating savings group.
      </p>
    </div>

    <!-- Error Alert -->
    <div
      *ngIf="error"
      class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4 border border-red-100 dark:border-red-900/40 flex items-start gap-4"
    >
      <div class="bg-red-100 dark:bg-red-800 p-2 rounded-full shrink-0">
        <span class="material-symbols-outlined text-red-600 dark:text-red-300"
          >error</span
        >
      </div>
      <div class="flex-1">
        <h4 class="text-sm font-bold text-red-900 dark:text-red-100 mb-1">
          Error
        </h4>
        <p class="text-sm text-red-800 dark:text-red-200">{{ error }}</p>
      </div>
      <button (click)="error = null" class="text-red-400 hover:text-red-600">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <!-- Form Container -->
    <div
      class="bg-white dark:bg-[#15281e] rounded-xl shadow-sm border border-border-light dark:border-border-dark overflow-hidden"
    >
      <form
        (ngSubmit)="onSubmit($event)"
        class="p-6 md:p-8 flex flex-col gap-8"
      >
        <!-- Dâr Details Section -->
        <div class="flex flex-col gap-6">
          <h3
            class="text-lg font-bold border-b border-border-light dark:border-border-dark pb-2 mb-2 flex items-center gap-2"
          >
            <span class="material-symbols-outlined text-primary"
              >edit_document</span
            >
            Basic Information
          </h3>

          <!-- Dâr Name Field -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-medium text-text-light dark:text-text-dark"
              for="dar-name"
              >Dâr Name</label
            >
            <div class="relative">
              <input
                class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-input-bg-light dark:bg-input-bg-dark text-text-light dark:text-white h-12 px-4 focus:border-primary focus:ring-primary dark:focus:border-primary dark:focus:ring-primary placeholder-gray-400 dark:placeholder-gray-500"
                id="dar-name"
                name="dar-name"
                placeholder="e.g. Office Colleagues 2024"
                type="text"
                [(ngModel)]="darName"
                required
              />
            </div>
          </div>

          <!-- Description Field -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-medium text-text-light dark:text-text-dark"
              for="description"
              >Description (Optional)</label
            >
            <div class="relative">
              <textarea
                class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-input-bg-light dark:bg-input-bg-dark text-text-light dark:text-white px-4 py-3 focus:border-primary focus:ring-primary dark:focus:border-primary dark:focus:ring-primary placeholder-gray-400 dark:placeholder-gray-500"
                id="description"
                name="description"
                placeholder="Describe the purpose of this Dâr..."
                rows="3"
                [(ngModel)]="description"
              ></textarea>
            </div>
          </div>

          <!-- Monthly Contribution -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-medium text-text-light dark:text-text-dark"
              for="monthly-amount"
              >Monthly Contribution</label
            >
            <div class="relative">
              <div
                class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
              >
                <span class="text-gray-500 sm:text-sm">$</span>
              </div>
              <input
                class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-input-bg-light dark:bg-input-bg-dark text-text-light dark:text-white h-12 pl-7 pr-12 focus:border-primary focus:ring-primary dark:focus:border-primary dark:focus:ring-primary placeholder-gray-400 dark:placeholder-gray-500"
                id="monthly-amount"
                name="monthly-amount"
                placeholder="0.00"
                type="number"
                [(ngModel)]="monthlyAmount"
                required
                min="0"
                step="0.01"
              />
              <div
                class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
              >
                <span class="text-gray-500 sm:text-sm">USD</span>
              </div>
            </div>
            <p class="text-xs text-red-500 mt-1 hidden" id="amount-error">
              Please enter a valid amount greater than 0.
            </p>
          </div>
        </div>

        <!-- Scheduling & Rules Section -->
        <div class="flex flex-col gap-6 pt-4">
          <h3
            class="text-lg font-bold border-b border-border-light dark:border-border-dark pb-2 mb-2 flex items-center gap-2"
          >
            <span class="material-symbols-outlined text-primary"
              >calendar_month</span
            >
            Schedule &amp; Rules
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Frequency -->
            <div class="flex flex-col gap-2">
              <label
                class="text-sm font-medium text-text-light dark:text-text-dark"
                for="frequency"
                >Payment Frequency</label
              >
              <div class="relative">
                <select
                  class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-input-bg-light dark:bg-input-bg-dark text-text-light dark:text-white h-12 px-4 focus:border-primary focus:ring-primary dark:focus:border-primary dark:focus:ring-primary appearance-none"
                  id="frequency"
                  name="frequency"
                  [(ngModel)]="frequency"
                  required
                >
                  <option value="weekly">Weekly</option>
                  <option value="bi-weekly">Bi-Weekly</option>
                  <option value="monthly">Monthly</option>
                  <option value="quarterly">Quarterly</option>
                </select>
                <div
                  class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                >
                  <span class="material-symbols-outlined text-gray-400"
                    >expand_more</span
                  >
                </div>
              </div>
            </div>

            <!-- Allocation Method -->
            <div class="flex flex-col gap-2">
              <label
                class="text-sm font-medium text-text-light dark:text-text-dark"
                for="allocation-method"
                >Allocation Method</label
              >
              <div class="relative">
                <select
                  class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-input-bg-light dark:bg-input-bg-dark text-text-light dark:text-white h-12 px-4 focus:border-primary focus:ring-primary dark:focus:border-primary dark:focus:ring-primary appearance-none"
                  id="allocation-method"
                  name="allocation-method"
                  [(ngModel)]="orderMethod"
                  required
                >
                  <option value="RANDOM_ONCE">Random (Once)</option>
                  <option value="DYNAMIQUE_RANDOM">Dynamic Random</option>
                  <option value="FIXED_ORDER">Fixed Order</option>
                  <option value="BIDDING_MODEL">Bidding</option>
                </select>
                <div
                  class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"
                >
                  <span class="material-symbols-outlined text-gray-400"
                    >expand_more</span
                  >
                </div>
              </div>
              <p
                class="text-xs text-gray-500 dark:text-gray-400 mt-1 flex items-center gap-1"
              >
                <span class="material-symbols-outlined text-[14px]">info</span>
                How payouts will be distributed to members
              </p>
            </div>
          </div>

          <!-- Rules (Optional) -->
          <div class="flex flex-col gap-2">
            <label
              class="text-sm font-medium text-text-light dark:text-text-dark"
              for="rules"
              >Custom Rules (Optional)</label
            >
            <div class="relative">
              <textarea
                class="w-full rounded-lg border-gray-300 dark:border-gray-600 bg-input-bg-light dark:bg-input-bg-dark text-text-light dark:text-white px-4 py-3 focus:border-primary focus:ring-primary dark:focus:border-primary dark:focus:ring-primary placeholder-gray-400 dark:placeholder-gray-500"
                id="rules"
                name="rules"
                placeholder="Add any specific rules or terms for this Dâr..."
                rows="3"
                [(ngModel)]="rules"
              ></textarea>
            </div>
          </div>
        </div>

        <!-- Action Bar -->
        <div
          class="flex flex-col-reverse sm:flex-row items-center justify-end gap-4 pt-6 mt-2 border-t border-border-light dark:border-border-dark"
        >
          <button
            class="w-full sm:w-auto px-6 h-12 rounded-lg text-gray-600 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
            type="button"
            (click)="onCancel()"
            [disabled]="isSubmitting"
          >
            Cancel
          </button>
          <button
            class="w-full sm:w-auto px-8 h-12 bg-primary hover:bg-green-500 text-black font-bold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
            type="submit"
            [disabled]="isSubmitting"
          >
            <span class="material-symbols-outlined">{{
              isSubmitting ? "hourglass_empty" : "check"
            }}</span>
            {{ isSubmitting ? "Creating..." : "Create Dâr" }}
          </button>
        </div>
      </form>
    </div>

    <!-- Help Section -->
    <div
      class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4 border border-blue-100 dark:border-blue-900/40 flex items-start gap-4"
    >
      <div class="bg-blue-100 dark:bg-blue-800 p-2 rounded-full shrink-0">
        <span class="material-symbols-outlined text-blue-600 dark:text-blue-300"
          >help</span
        >
      </div>
      <div>
        <h4 class="text-sm font-bold text-blue-900 dark:text-blue-100 mb-1">
          Need help setting up?
        </h4>
        <p class="text-sm text-blue-800 dark:text-blue-200">
          Typically, a Dâr lasts for as many months as there are members. If you
          have 10 members, the cycle will last 10 months. Ensure everyone agrees
          on the monthly contribution before starting.
        </p>
      </div>
    </div>
  </div>
</main>
